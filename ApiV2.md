<base target="_blank">

# API
Typsy provides an API for basic operations on Users and Accounts.

## Actions
The supported actions are:
Authenticate
1. Test Authentication with the API

User API
1. Create a user (assign a license to a new user)
2. Depart a user (removes the assigned license and prevents login)
3. Add a user to a Structure
4. Remove a user from a Structure
5. Add a user to a Team
6. Remove a user from a team
7. Add Claims to a user
8. Remove Claims from a user

Account API
1. Create a new child account

## Authentication
Typsy will provide you with the following items:
1. Public API Key: A unique key used to generate the hash. 
2. Private API Key: A unique key used as part of the hash.

### Generating the HMAC SHA256 Hash
The following values are required to produce the hash which is included with each request.

1. UTC Timestamp
2. Public API Key
3. Private API Key

#### UTC Timestamp
The timestamp must be in the following format: yyyy-MM-ddTHH:mm:SS.fffffffZ and must be the current time.

In C# this is generated using the following line of code:

    DateTime.UtcNow.ToString("O");

Failure to provide a current UTC timestamp will result in a 401 status code and the following error message:

	"Timestamp '2018-11-14T11:19:03.7269943Z' outside of acceptable range. Ensure that the timestamp you provide is current UTC time - e.g. now is '2023-08-09T23:18:21.4801739Z'."

#### Typsy Key
The value for the Typsy-Key header value is a Hash of your Typsy Keys and UTC timestamp.  

The value is created by concatenating your **Private API Key** with the **UTC timestamp**. The hash must be generated for each request as it contains a timestamp.

If your Private API Key is **0a00a000aa0a0a0a0000a0000a00a000** and the UTC timestamp is **2023-09-18T11:19:03.7269943Z** then you concatenate as follows:

	{PRIVATE KEY}:{TIMESTAMP}

	0a00a000aa0a0a0a0000a0000a00a000:2023-09-18T11:19:03.7269943Z

This value is then hashed with your Public API Key to generate your HMAC-SHA-256-SECRET. The Public API Key in this example is **aaa00000-0a0a-0000-a0aa-000a0000a00a**

The secret generated by the above example is: 
	
	3ca489e0a7e395de121658ba760280e7aabaa33dd15612f83b0eba7f6060b988

This can be demonstrated/tested using the following tool: http://beautifytools.com/hmac-generator.php
1. Where it says 'Enter message here' place: 0a00a000aa0a0a0a0000a0000a00a000:2023-09-18T11:19:03.7269943Z
2. Where it says 'Secret key' place: aaa00000-0a0a-0000-a0aa-000a0000a00a
3. Select alogorithim: sha256

![image](https://github.com/typsy-dev/documentation/blob/master/assets/hmac_generation.png)

___

##### Generating the encrypted key
Here is a [code sample](https://github.com/typsy-dev/web-player/blob/master/asp-net-core/asp-net-core/Utilities/EncryptionHelper.cs) in C# that demonstrates how to create the encrypted key.

___

These values must be added to the header of each request, see the following example from Postman.

1. Typsy-Timestamp: <INSERT UTC TIMESTAMP>
2. Typsy-Public-Key: <INSERT PUBLIC API KEY>
3. Typsy-Key: <INSERT HMACSHA256 HASH OF PRIVATE KEY AND TIMESTAMP>

![image](https://github.com/typsy-dev/documentation/blob/master/assets/postman_headers.png)

## Validate Authentication
A request can be sent to validate that authentication is working correctly.

### Endpoint
GET to https://api.typsy.com/v2/authenticate

### Request
Send an empty request but with all the required parameters for authentication.

### Response
If authentication has been successful you will be returned a 200 status code.  If you receive a 40x status code then investigate if all the required parameters for authentication have been constructed correctly and provided in the request.

## User create

### Endpoint
POST to https://api.typsy.com/v2/users/create

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs. 

### Request
- firstName: The first name of the user
- lastName: The last name of the user
- email: The email of the user
- structures: Used for adding the user into venues/departments/groups within your account
- teams: Used for adding the user into teams within your account - optional, 
- claims: Used for adding the claims for the user - optional,
- ssoUserIdentifier: Used for adding the user identifier for SSO login - required for SSO connected accounts only
- options: Used to enable certain options to perform

Example request to create a user (minimum information).  
```
{
    "firstName": "FirstName",
    "lastName": "LastName",
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        }
    ],
    "options": {
        "sendInvitation": false,
        "createStructuresIfNotExist": true,
        "reactivateIfDeparted": false
    }
}
```
Example request to create a user (additional information).  
```
{
    "firstName": "FirstName",
    "lastName": "LastName",
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        },
        {
            "name": "Venue B",
            "role": "manager"
        }
    ],
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "claims": [
        {
            "key": "external_id",
            "value": "12345678910"
            "issuer": "IssuerName"
        }
    ],
    "ssoUserIdentifier": {
        "providerName": "ProviderName",
        "providerKey": "123456",
    }
    "options": {
        "sendInvitation": false,
        "createStructuresIfNotExist": true,
        "createTeamsIfNotExist": true,
        "reactivateIfDeparted": false
    }
}
```  
### Response
Example response where create a user request has been successful.
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/a2e553c0-c963-4bdd-87de-1805122740e6"
}
```
## User depart

### Endpoint
POST to https://api.typsy.com/v2/users/depart

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- options: Used to enable certain options to perform
  
Example request to depart a user by email.  
```
{
    "email": first.last@domain.com,
    "options": {
        "sendFarewellEmail": false
    }
}
```
### Response
Example response where depart a user request has been successful.
```
{
    "requestId": "f1c8c78c-78f0-4b50-af09-df0a14dc3759",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/f1c8c78c-78f0-4b50-af09-df0a14dc3759"
}
```
## User add teams

### Endpoint
POST to https://api.typsy.com/v2/users/teams/add

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- teams: Used for adding the user into teams within your account - optional, 
- options: Used to enable certain options to perform

Example request to add teams to a user by email. 
```
{
    "email": "first.last@domain.com",
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "options": {
        "createTeamsIfNotExist": true,
    }
}
```
### Response
Example response where add teams to a user request has been successful.
```
{
    "requestId": "1135fd80-ac65-41b9-8db5-f7c2f379e9ab",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/1135fd80-ac65-41b9-8db5-f7c2f379e9ab"
}
```
## User remove teams

### Endpoint
POST to https://api.typsy.com/v2/users/teams/remove

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- teams: Used for adding the user into teams within your account - optional, 
- options: Used to enable certain options to perform

Example request to remove teams from a user by email. 
```
{
    "email": "first.last@domain.com",
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "options": {
        "continueIfNotInTeam": true,
    }
}
```
### Response
Example response where remove teams from a user request has been successful.
```
{
    "requestId": "cf74d64e-bf7b-4b35-bee9-427c16ca051b",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/cf74d64e-bf7b-4b35-bee9-427c16ca051b"
}
```
## User add structures

### Endpoint
POST to https://api.typsy.com/v2/users/structures/add

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- structures: Used for adding the user into venues/departments/groups within your account
- options: Used to enable certain options to perform

Example request to add structures to a user by email.  
```
{
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        }
    ],
    "options": {
        "createStructuresIfNotExist": true,
    }
}
```
### Response
Example response where add structures to a user request has been successful.
```
{
    "requestId": "8bd1e102-95d1-4965-a9c3-a73a5fc88101",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/8bd1e102-95d1-4965-a9c3-a73a5fc88101"
}
```
## User remove structures

### Endpoint
POST to https://api.typsy.com/v2/users/structures/remove

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- structures: Used for adding the user into venues/departments/groups within your account
- options: Used to enable certain options to perform

Example request to remove structures from a user by email. 
```
{
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
        }
    ],
    "options": {
        "continueIfNotInStruture": true,
    }
}
```
### Response
Example response where remove structures from a user request has been successful.
```
{
    "requestId": "3b332916-62d8-4a95-a6c7-f83217f3e2ed",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/3b332916-62d8-4a95-a6c7-f83217f3e2ed"
}
```
## User add claims

### Endpoint
POST to https://api.typsy.com/v2/users/claims/add

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- claims: Used for adding the claims for the user - optional, 

Example request to add claims to a user by email. 
```
{
    "email": "first.last@domain.com",
    "claims": [
        {
            "key": "external_id",
            "value": "12345678910",
	    "issuer": "IssuerName"
        }
    ]
}
```
### Response
Example response where add claims to a user request has been successful.
```
{
    "requestId": "e20f2b42-cfdc-434f-a616-710088da4e00",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/e20f2b42-cfdc-434f-a616-710088da4e00"
}
```
## User remove claims

### Endpoint
POST to https://api.typsy.com/v2/users/claims/remove

### Header
Typsy-Account-Identifier : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Request
- email: The email of the user
- claims: Used for adding the claims for the user - optional, 

Example request to remove claims from a user by email. 
```
{
    "email": "first.last@domain.com",
    "claims": [
        {
            "key": "external_id",
            "value": "12345678910",
	    "issuer": "IssuerName"
        }
    ]
}
```
### Response
Example response where remove claims from a user request has been successful.
```
{
    "requestId": "580db06c-93ea-4c67-9d05-750530180c6c",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/580db06c-93ea-4c67-9d05-750530180c6c"
}
```
## Request Status

### Endpoint
GET to https://api.typsy.com/v2/users/request-status/{requestId}

#### Request not processed yet
If the initial request has not yet been processed you will receive a [204 No Content](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) result.  Wait a minute and make another request.

#### Request processed successfully
Example response where the user create request has been successful.
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "success",
    "errors": [],
    "success": true
}
```
#### Bad request
Example response where the user create request has failed.
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "failed",
    "errors": [
        {
            "code": "user_already_exists",
            "description": "A user with the email EMAIL already exists within your account."
        }
    ],
    "success": false
}
```
## Account create
Used to create child accounts with in a parent account

### Endpoint
POST to https://api.typsy.com/v2/accounts/create

### Request
 - name: Name of your property
 - vanityName: The name of the property that the Users will see
 - timezoneInfoId: The timezone which the property operates in (https://stackoverflow.com/questions/7908343/list-of-timezone-ids-for-use-with-findtimezonebyid-in-c)
 - country: 2 letter country code the property resides in (https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes)
 - identifier: The internal code your company uses to identify its properties, needed to identify which child account Users will be created in when using the User API
 - structures: Used for creating venues/departments/groups within your account to sort your Users into - optional, structures can also be created via the Users API
 - teams: Used for creating teams within your account to sort your Users into - optional, teams can also be created via the Users API

```
{
  "name": "My Account Pty Ltd",
  "vanityName": "My Account",
  "timezoneInfoId": "AUS Eastern Standard Time",
  "country": "AU",
  "identifier": "MEL_HOTEL1",
  "structures": [
    {
      "name": "Hotel Restaurant"
    },
    {
      "name": "Hotel Bar"
    }
  ],
  "teams": [
    {
      "name": "Dishwashers"
    },
    {
      "name": "Bartenders"
    }
  ]
}
```


### Response

Example response where the Account create request has been successful.

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/accounts/request-status/23365f4b-7ae8-4d4d-bb74-ad8b4bfee647"
}
```

## Request Status

### Endpoint
GET to https://api.typsy.com/v2/accounts/request-status/{requestId}

#### Request not processed yet
If the initial request has not yet been processed you will receive a [204 No Content](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) result.  Wait a minute and make another request.

#### Request processed successfully
Example response where the account create request has been successful.

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "success",
    "errors": [],
    "success": true
}
```


#### Bad request
Example response where the account create request has failed.

```
{
    "workspaceId": null,
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "failed",
    "errors": [
        {
            "code": "account_already_exists",
            "description": "An account with the corporationId CORPORATION_ID and identifier MY_IDENTIFIER already exists"
        }
    ],
    "success": false
}
```
