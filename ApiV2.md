<base target="_blank">

# API
Typsy provides an API for basic operations on Users and Accounts.

## Actions
The supported actions are:
Authenticate
1. Test Authentication with the API

User API
1. Create a user (assign a license to a new user)
2. Depart a user (removes the assigned license and prevents login)
3. Add Claims to a user
4. Remove Claims from a user
5. Add a user to a Structure
6. Remove a user from a Structure
7. Add a user to a Team
8. Remove a user from a team

Account API
1. Create a new child account

## Authentication
Typsy will provide you with the following items:
1. Public API Key: A unique key used to generate a hash.  The key is in the following format: your-public-api-key-a1b2c3d4
2. Private API Key: a1b2c3d4e5f6g7h8i9k10

### Generating the HMAC SHA256 Hash
The following values are required to produce the hash which is included with each request.

1. UTC Timestamp
2. Public API Key
3. Private API Key

#### UTC Timestamp
The timestamp must be in the following format: yyyy-MM-ddTHH:mm:SS.fffffffZ and must be the current time.

In C# this is generated using the following line of code:

    DateTime.UtcNow.ToString("O");

Failure to provide a current UTC timestamp will result in a 401 status code and the following error message:

	"Timestamp '2018-11-14T11:19:03.7269943Z' outside of acceptable range. Ensure that the timestamp you provide is current UTC time - e.g. now is '2023-08-09T23:18:21.4801739Z'."

#### Typsy Key
The value for the Typsy-Key header value is a Hash of your Typsy Key and UTC timestamp.  

The value is created by concatenating your **Typsy Key** with the **UTC timestamp**. The hash must be generated for each request as it contains a timestamp.

If your Private API Key is **a1b2c3d4e5f6g7h8i9k10** and the UTC timestamp is **2023-09-18T11:19:03.7269943Z** then you concatenate as follows:

	{PRIVATE KEY}:{TIMESTAMP}

	a1b2c3d4e5f6g7h8i9k10:2023-09-18T11:19:03.7269943Z

This value is then hashed with your Public API Key to generate your HMAC-SHA-256-SECRET.

The secret generated by the above example is: 
	
	c5a1ec1c587e4871961ed518324f83573bc1f445c73722973972d29d770818fa

This can be demonstrated/tested using the following tool: http://beautifytools.com/hmac-generator.php
1. Where it says 'Enter message here' place: a1b2c3d4e5f6g7h8i9k10:2023-09-18T11:19:03.7269943Z
2. Where it says 'Secret key' place: a1b2c3d4e5f6g7h8i9k10
3. Select alogorithim: sha256

![image](https://github.com/typsy-dev/documentation/blob/master/assets/hmac_generation.png)

___

##### Generating the encrypted key
Here is a [code sample](https://github.com/typsy-dev/web-player/blob/master/asp-net-core/asp-net-core/Utilities/EncryptionHelper.cs) in C# that demonstrates how to create the encrypted key.

___

These values must be added to the header of each request, see the following example from Postman.

1. Typsy-Timestamp: <INSERT UTC TIMESTAMP>
2. Typsy-Public-Key: <INSERT PUBLIC API KEY>
3. Typsy-Key: <INSERT HMACSHA256 HASH OF PRIVATE KEY AND TIMESTAMP>

![image](https://github.com/typsy-dev/documentation/blob/master/assets/postman_headers.png)

## Validate Authentication
A request can be sent to validate that authentication is working correctly.

### Endpoint
GET to https://api.typsy.com/v2/authenticate

### Request
Send an empty request but with all the required parameters for authentication.

### Response
If authentication has been successful you will be returned a 200 status code.  If you receive a 40x status code then investigate if all the required parameters for authentication have been constructed correctly and provided in the request.

## User create

### Endpoint
POST to https://api.typsy.com/v2/users/create

### Request

### Response

## User update

### Endpoint
POST to https://api.typsy.com/v2/users/update

### Request

### Response

## User add teams

### Endpoint
POST to https://api.typsy.com/v2/users/update/teams/add

### Request

### Response

## User remove teams

### Endpoint
POST to https://api.typsy.com/v2/users/update/teams/remove

### Request

### Response

## User add structures

### Endpoint
POST to https://api.typsy.com/v2/users/update/structures/add

### Request

### Response

## User remove structures

### Endpoint
POST to https://api.typsy.com/v2/users/update/structures/remove

### Request

### Response

## User add claims

### Endpoint
POST to https://api.typsy.com/v2/users/update/claims/add

### Request

### Response

## User remove claims

### Endpoint
POST to https://api.typsy.com/v2/users/update/claims/remove

### Request

### Response


## Account create
Used to create child accounts with in a parent account

### Endpoint
POST to https://api.typsy.com/v2/accounts/create

### Request
 - name: Name of your property
 - vanityName: The name of the property that the Users will see
 - timezoneInfoId: The timezone which the property operates in (https://stackoverflow.com/questions/7908343/list-of-timezone-ids-for-use-with-findtimezonebyid-in-c)
 - country: 2 letter country code the property resides in (https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes)
 - identifier: The internal code your company uses to identify its properties, needed to identify which child account Users will be created in when using the User API
 - structures: Used for creating venues/departments/groups within your account to sort your Users into - optional, structures can also be created via the Users API
 - teams: Used for creating teams within your account to sort your Users into - optional, teams can also be created via the Users API

```
{
  "name": "My Account Pty Ltd",
  "vanityName": "My Account",
  "timezoneInfoId": "AUS Eastern Standard Time",
  "country": "AU",
  "identifier": "MEL_HOTEL1",
  "structures": [
    {
      "name": "Hotel Restaurant"
    },
    {
      "name": "Hotel Bar"
    }
  ],
  "teams": [
    {
      "name": "Dishwashers"
    },
    {
      "name": "Bartenders"
    }
  ]
}
```


### Response

Example response where the Account create request has been successful.

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/accounts/request-status/23365f4b-7ae8-4d4d-bb74-ad8b4bfee647"
}
```

## Request Status

### Endpoint
GET to https://api.typsy.com/v2/accounts/request-status/{requestId}

#### Request not processed yet
If the initial request has not yet been processed you will receive a [204 No Content](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) result.  Wait a minute and make another request.

#### Request processed successfully
Example response where the account create request has been successful.

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "success",
    "errors": [],
    "success": true
    "accountId": 1234567
}
```


#### Bad request
Example response where the account create request has failed.

```
{
    "workspaceId": null,
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "failed",
    "errors": [
        {
            "code": "account_already_exists",
            "description": "An account with the corporationId CORPORATION_ID and identifier MY_IDENTIFIER already exists"
        }
    ],
    "success": false
}
```