<base target="_blank">

# API
Typsy provides an API for basic operations on Users and Accounts.

## Actions
The supported actions are:

Authenticate
1. [Test Authentication with the API](#authentication)

User API
1. [Create a user (assign a license to a new user)](#user-create)
2. [Depart a user (removes the assigned license and prevents login)](#user-depart)
3. [Add a user to a Structure](#user-add-structures)
4. [Remove a user from a Structure](#user-remove-structures)
5. [Add a user to a Team](#user-add-teams)
6. [Remove a user from a team](#user-remove-teams)
7. [Add Claims to a user](#user-add-claims)
8. [Remove Claims from a user](#user-remove-claims)
9. [Get Users list](#list-users)
10. [Get a User](#get-user)

Account API
1. [Create a new child account](#account-create)
2. [Add a Role to a User in a child account](#account-role-add)
3. [Remove a Role from a User in a child account](#account-role-remove)
4. [Get Accounts list](#list-accounts)
5. [Get a Account](#get-account)

## Authentication
Typsy will provide you with the following items:
1. Public API Key: A unique key used to generate the hash. 
2. Private API Key: A unique key used as part of the hash.

### Generating the HMAC SHA256 Hash
The following values are required to produce the hash which is included with each request.

1. UTC Timestamp
2. Public API Key
3. Private API Key

#### UTC Timestamp
The timestamp must be in the following format: yyyy-MM-ddTHH:mm:SS.fffffffZ and must be the current time.

In C# this is generated using the following line of code:

    DateTime.UtcNow.ToString("O");

Failure to provide a current UTC timestamp will result in a 401 status code and the following error message:

	"Timestamp '2018-11-14T11:19:03.7269943Z' outside of acceptable range. Ensure that the timestamp you provide is current UTC time - e.g. now is '2023-08-09T23:18:21.4801739Z'."

#### Typsy Key
The value for the Typsy-Key header value is a Hash of your Typsy Keys and UTC timestamp.  

The value is created by concatenating your **Private API Key** with the **UTC timestamp**. The hash must be generated for each request as it contains a timestamp.

If your Private API Key is **0a00a000aa0a0a0a0000a0000a00a000** and the UTC timestamp is **2023-09-18T11:19:03.7269943Z** then you concatenate as follows:

	{PRIVATE KEY}:{TIMESTAMP}

	0a00a000aa0a0a0a0000a0000a00a000:2023-09-18T11:19:03.7269943Z

This value is then hashed with your Public API Key to generate your HMAC-SHA-256-SECRET. The Public API Key in this example is **aaa00000-0a0a-0000-a0aa-000a0000a00a**

The secret generated by the above example is: 
	
	3ca489e0a7e395de121658ba760280e7aabaa33dd15612f83b0eba7f6060b988

This can be demonstrated/tested using the following tool: http://beautifytools.com/hmac-generator.php
1. Where it says 'Enter message here' place: 0a00a000aa0a0a0a0000a0000a00a000:2023-09-18T11:19:03.7269943Z
2. Where it says 'Secret key' place: aaa00000-0a0a-0000-a0aa-000a0000a00a
3. Select alogorithim: sha256

![image](https://github.com/typsy-dev/documentation/blob/master/assets/hmac_generation.png)

___

##### Generating the encrypted key
Here is a [code sample](https://github.com/typsy-dev/web-player/blob/master/asp-net-core/asp-net-core/Utilities/EncryptionHelper.cs) in C# that demonstrates how to create the encrypted key.

___

These values must be added to the header of each request, see the following example from Postman.

1. Typsy-Timestamp: <INSERT UTC TIMESTAMP>
2. Typsy-Public-Key: <INSERT PUBLIC API KEY>
3. Typsy-Key: <INSERT HMACSHA256 HASH OF PRIVATE KEY AND TIMESTAMP>

![image](https://github.com/typsy-dev/documentation/blob/master/assets/postman_headers.png)

## Validate Authentication
A request can be sent to validate that authentication is working correctly.

### Endpoint
GET to https://api.typsy.com/v2/authenticate

### Request
Send an empty request but with all the required parameters for authentication.

### Response
If authentication has been successful you will be returned a 200 status code.  If you receive a 40x status code then investigate if all the required parameters for authentication have been constructed correctly and provided in the request.

# Users

If you're a master account you will need to add this header to your requests
- Typsy-Account-Code : The internal code your company uses to identify its properties, needed to identify which child account the user belongs to.

If there is an issue with locating the child account matching the code you provided, you will receive a 400 Bad Request response.

## User create

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/create

### Request
Required
- firstName: The first name of the user
- lastName: The last name of the user
- email: The email of the user
- structures: The collection of structures (venues/departments/groups) you wish to add the user to
    - name: the name of the structure
    - role: the role for the member within the structure. Possible values: member, manager

Required for SSO connected accounts
- ssoUserIdentifier: Used for adding the user identifier for SSO login.

Optional
- teams: The collection of teams you wish to add the user to
    - name: the name of the team
- claims: A collection of claims you wish to add the user to
    - key: the name of your external id
    - value: the value of your external id
    - issuer: who issued the claim (often just your overall account name)

- options:
    - sendInvitation: sends an invitation to the user to claim their account. If your account is set up with SSO this must be set to false or the API will return an error. Default = false
    - createStructuresIfNotExist: creates the structure within the account if it does not already exist. Default = true
    - createTeamsIfNotExist: creates the team within the account if it does not already exist. Default = true
    - reactivateIfDeparted: if the user was previously departed from this account it reactivates them within the account if set to true. If set to false, it will give you an error saying that the user was departed from this account. Default = false

Example request to create a user (minimum information).  
```
{
    "firstName": "FirstName",
    "lastName": "LastName",
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        }
    ],
    "options": {
        "sendInvitation": false,
        "createStructuresIfNotExist": true,
        "reactivateIfDeparted": false
    }
}
```
Example request to create a user (additional information).  
```
{
    "firstName": "FirstName",
    "lastName": "LastName",
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        },
        {
            "name": "Venue B",
            "role": "manager"
        }
    ],
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "claims": [
        {
            "key": "external_id",
            "value": "12345678910"
            "issuer": "IssuerName"
        }
    ],
    "ssoUserIdentifier": "123456",
    "options": {
        "sendInvitation": false,
        "createStructuresIfNotExist": true,
        "createTeamsIfNotExist": true,
        "reactivateIfDeparted": false
    }
}
```  

### Response
Example response where create a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/a2e553c0-c963-4bdd-87de-1805122740e6"
}
```
## User depart

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/depart

### Request
Required
- email: The email of the user

Optional
- options:
    - sendFarewellEmail: sends a farewell email after a period of time to the user after they have been departed, letting them know what has happened to their account and learning history. Default = false
  
Example request to depart a user by email.  
```
{
    "email": first.last@domain.com,
    "options": {
        "sendFarewellEmail": false
    }
}
```

### Response
Example response where depart a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "f1c8c78c-78f0-4b50-af09-df0a14dc3759",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/f1c8c78c-78f0-4b50-af09-df0a14dc3759"
}
```

## User add teams

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/teams/add

### Request
Required
- email: The email of the user
- teams: The collection of teams you wish to add the user to

Optional
- options:
    - createTeamsIfNotExist: creates the team within the account if it does not already exist. Default = true

Example request to add teams to a user by email. 
```
{
    "email": "first.last@domain.com",
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "options": {
        "createTeamsIfNotExist": true,
    }
}
```

### Response
Example response where add teams to a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "1135fd80-ac65-41b9-8db5-f7c2f379e9ab",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/1135fd80-ac65-41b9-8db5-f7c2f379e9ab"
}
```
## User remove teams

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/teams/remove

### Request
Required
- email: The email of the user
- teams: The collection of teams you wish to remove the user from

Optional
- options:
    - continueIfNotInTeam: If the user is not in a team which they were requested to be removed from, the process will continue. If set to false, it will return an error telling you they are not in the team. Default = true

Example request to remove teams from a user by email. 
```
{
    "email": "first.last@domain.com",
    "teams": [
        {
            "name": "Team A"
        }
    ],
    "options": {
        "continueIfNotInTeam": true,
    }
}
```

### Response
Example response where remove teams from a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "cf74d64e-bf7b-4b35-bee9-427c16ca051b",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/cf74d64e-bf7b-4b35-bee9-427c16ca051b"
}
```
## User add structures

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/structures/add

### Request
Required
- email: The email of the user
- structures: The collection of structures (venues/departments/groups) you wish to add the user to

Optional
- options:
    - createStructuresIfNotExist: creates the structure within the account if it does not already exist. Default = true

Example request to add structures to a user by email.  
```
{
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
            "role": "member"
        }
    ],
    "options": {
        "createStructuresIfNotExist": true,
    }
}
```

### Response
Example response where add structures to a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "8bd1e102-95d1-4965-a9c3-a73a5fc88101",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/8bd1e102-95d1-4965-a9c3-a73a5fc88101"
}
```
## User remove structures

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/structures/remove

### Request
Required
- email: The email of the user
- structures: The collection of structures (venues/departments/groups) you wish to remove the user from

Optional
- options:
    - continueIfNotInStructure: If the user is not in a structure which they were requested to be removed from, the process will continue. If set to false, it will return an error telling you they are not in the structure. Default = true

Example request to remove structures from a user by email. 
```
{
    "email": "first.last@domain.com",
    "structures": [
        {
            "name": "Venue A",
        }
    ],
    "options": {
        "continueIfNotInStructure": true,
    }
}
```

### Response
Example response where remove structures from a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "3b332916-62d8-4a95-a6c7-f83217f3e2ed",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/3b332916-62d8-4a95-a6c7-f83217f3e2ed"
}
```
## User add claims

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/claims/add

### Request
Required
- email: The email of the user
- claims: A collection of claims you wish to add the user to
    - key: the name of your external id
    - value: the value of your external id
    - issuer: who issued the claim (often just your overall account name)

Example request to add claims to a user by email. 
```
{
    "email": "first.last@domain.com",
    "claims": [
        {
            "key": "external_id",
            "value": "12345678910",
            "issuer": "IssuerName"
        }
    ]
}
```

### Response
Example response where add claims to a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "e20f2b42-cfdc-434f-a616-710088da4e00",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/e20f2b42-cfdc-434f-a616-710088da4e00"
}
```

## User remove claims

### Endpoint
POST to https://api.typsy.com/v2/users/workspace/claims/remove

### Request
Required
- email: The email of the user
- claims: A collection of claims you wish to remove the user from
    - key: the name of your external id
    - issuer: who issued the claim (often just your overall account name)

Example request to remove claims from a user by email. 
```
{
    "email": "first.last@domain.com",
    "claims": [
        {
            "key": "external_id",
	        "issuer": "IssuerName"
        }
    ]
}
```

### Response
Example response where remove claims from a user request has been successful. The documentation on what do with the requestId is [here](#request-status)
```
{
    "requestId": "580db06c-93ea-4c67-9d05-750530180c6c",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/users/request-status/580db06c-93ea-4c67-9d05-750530180c6c"
}
```

## Request Status

### Endpoint
GET to https://api.typsy.com/v2/users/request-status/{requestId}

#### Request not processed yet
If the initial request has not yet been processed you will receive a [204 No Content](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) result.  Wait a minute and make another request.

#### Request processed successfully
Example response where the user create request has been successful.
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "success",
    "errors": [],
    "success": true
}
```

#### Bad request
Example response where the user create request has failed.
```
{
    "requestId": "a2e553c0-c963-4bdd-87de-1805122740e6",
    "status": "failed",
    "errors": [
        {
            "code": "user_already_exists",
            "description": "A user with the email EMAIL already exists within your account."
        }
    ],
    "success": false
}
```

## List Users

### Endpoint
GET to https://api.typsy.com/v2/users?offset=0&limit=25

### Request
Optional
 - offset: How many records to skip. This is used to page through records. Default = 0
 - limit: Amount of records to return for the request. Minimum value is 1 and Maximum is 25. This value is clamped on the server side. Default = 1

### Response
- users: A collection of UserSummary objects
- metadata:
    - total - total amount of users within your master account
    - count - how many users were returned
    - limit - how many users were requested
    - offset - how many users were skipped
```
{
    "users": [
	{
	    "identifier": "f12d3f0fa6b94c5fa9ce2934fefa0cc3"
	    "firstName": "FirstName",
	    "lastName": "LastName",
	    "email": "first.last@domain.com",
	    "ssoUserIdentifier": "123456",
	    "workspace": {
    		"identifier": "11844d3c366948f1b14ce3654a7795b2",
    		"status": "Licensed",
            "structureCount": 2,
    		"teamCount": 2,
    		"claimsCount": 1
	    }
	}
    ],
    "metadata": {
	"total": 3,
        "count": 1,
        "limit": 1,
        "offset": 0
    }
}
```

## Get User

### Endpoint
POST to https://api.typsy.com/v2/users/workspace

### Request
Required:
 - email: The email provided in the create user step (or)
 - ssoUserIdentifier : The user identifier used for SSO login

 Example request to get userby email. 
```
{
    "email": "first.last@domain.com"
}
```

 Example request to get userby ssoUserIdentifier. 
```
{
    "ssoUserIdentifier": "123456"
}
```

### Response
Returns an UserDetailed object.

```
{
    "identifier": "f12d3f0fa6b94c5fa9ce2934fefa0cc3",
    "firstName": "FirstName",
    "lastName": "LastName",
    "email": "first.last@domain.com",
    "ssoUserIdentifier": "123456",
    "workspace": {
	"identifier": "11844d3c366948f1b14ce3654a7795b2",
	"status": "Licensed",
	"structures": [
	    {
	        "name": "Venue A",
	        "role": "member"
	    },
	    {
	        "name": "Venue B",
	        "role": "manager"
	    }
        ],
        "teams": [
	    {
	        "name": "Team A"
	    }
        ],
        "claims": [
	    {
	        "key": "external_id",
	        "value": "12345678910"
	        "issuer": "IssuerName"
	    }
        ]
    }
}
```

#### No user found

A 204 No Content response will be returned if no user matching the email can be found within the account.

# Accounts

## Account create
Used to create child accounts with in a parent account

### Endpoint
POST to https://api.typsy.com/v2/accounts/create

### Request
Required
 - name: Name of your property
 - vanityName: The name of the property that the Users will see
 - tzIdentifier: The timezone which the property operates in (https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
 - country: 2 letter country code the property resides in (https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes)
 - Code: The internal code your company uses to identify its properties, needed to identify which child account Users will be created in when using the User API

 Optional
 - structures: Used for creating structures (venues/departments/groups) within your account to sort your Users into 
 - teams: Used for creating teams within your account to sort your Users into

```
{
  "name": "My Account Pty Ltd",
  "vanityName": "My Account",
  "tzIdentifier": "Australia/Melbourne",
  "country": "AU",
  "Code": "MEL_HOTEL1",
  "structures": [
    {
      "name": "Hotel Restaurant"
    },
    {
      "name": "Hotel Bar"
    }
  ],
  "teams": [
    {
      "name": "Dishwashers"
    },
    {
      "name": "Bartenders"
    }
  ]
}
```


### Response

Example response where the Account create request has been successful. The documentation on what do with the requestId is [here](#request-status-1)

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/accounts/request-status/23365f4b-7ae8-4d4d-bb74-ad8b4bfee647"
}
```

## Request Status

### Endpoint
GET to https://api.typsy.com/v2/accounts/request-status/{requestId}

#### Request not processed yet
If the initial request has not yet been processed you will receive a [204 No Content](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204) result.  Wait a minute and make another request.

#### Request processed successfully
Example response where the account create request has been successful. The documentation on what do with the requestId is [here](#request-status-1)

```
{
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "success",
    "errors": [],
    "success": true
}
```


#### Bad request
Example response where the account create request has failed.

```
{
    "workspaceId": null,
    "requestId": "23365f4b-7ae8-4d4d-bb74-ad8b4bfee647",
    "status": "failed",
    "errors": [
        {
            "code": "account_already_exists",
            "description": "An account with the corporationId CORPORATION_ID and code MY_CODE already exists"
        }
    ],
    "success": false
}
```

## Account role add 
Used to add role to a user with in a child account

If you're a master account you will need to add this header to your requests
- Typsy-Account-Code : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Endpoint
POST to https://api.typsy.com/v2/accounts/roles/add

### Request
Required
 - email: The email of the user
 - role: The role user needs to be added to. Possible values: administrator
```
{
    "email": "first.last@domain.com",
    "role": "administrator"
}
```
### Response

Example response where the Account create request has been successful. The documentation on what do with the requestId is [here](#request-status-1)

```
{
    "requestId": "660c5f82-7bb0-4fa2-a6fa-0cabf7cd62b3",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/accounts/request-status/660c5f82-7bb0-4fa2-a6fa-0cabf7cd62b3"
}
```

## Account role remove 
Used to remove role from a user with in a child account

If you're a master account you will need to add this header to your requests
- Typsy-Account-Code : The internal code your company uses to identify its properties, needed to identify which child account the user belongs.

### Endpoint
POST to https://api.typsy.com/v2/accounts/roles/remove

### Request
Required
 - email: The email of the user
 - role: The role user needs to be removed from. Possible values: administrator
```
{
    "email": "first.last@domain.com",
    "role": "administrator"
}
```
### Response

Example response where the Account create request has been successful. The documentation on what do with the requestId is [here](#request-status-1)

```
{
    "requestId": "b0116927-bebb-4f88-8e4f-f9f729f5027c",
    "status": "in progress",
    "errors": [],
    "success": true
    "statusUrl": "https://api.typsy.com/v2/accounts/request-status/b0116927-bebb-4f88-8e4f-f9f729f5027c"
}
```

## List Accounts

### Endpoint
GET to https://api.typsy.com/v2/accounts?offset=0&limit=25

### Request
Optional
 - offset: How many records to skip. This is used to page through records. Default = 0
 - limit: Amount of records to return for the request. Minimum value is 1 and Maximum is 25. This value is clamped on the server side. Default = 1

### Response
- accounts: A collection of AccountSummary objects
- corporationId: The identifier which is shared between all of your master and child accounts 
- metadata:
    - total - total amount of accounts within your master account
    - count - how many accounts were returned
    - limit - how many accounts were requested
    - offset - how many accounts were skipped
```
{
    "accounts": [
        {
          "identifier": "1f2d3f0aa6b94cb5a9ce2934fefa0cc3",
          "code": "MEL_HOTEL1",
          "name": "My Account Pty Ltd",
          "vanityName": "My Account",
          "tzIdentifier": "Australia/Melbourne",
          "country": "AU",
          "structureCount": 2,
          "teamCount": 2
        }
    ],
    "corporationId": "test_corporation",
    "metadata": {
        "total": 13,
        "count": 1,
        "limit": 1,
        "offset": 0
    }
}
```

## Get Account

### Endpoint
GET to https://api.typsy.com/v2/accounts/{code}

### Request
Required
 - code: The code provided in the create account step

### Response
Returns an AccountSummaryDetailed object.

```
{
  "identifier": "1f2d3f0aa6b94cb5a9ce2934fefa0cc3",
  "code": "MEL_HOTEL1",
  "name": "My Account Pty Ltd",
  "vanityName": "My Account",
  "tzIdentifier": "Australia/Melbourne",
  "country": "AU",
  "structures": [
    {
      "identifier": "4f3ee0a5a6d649a1be0e5bb523c21451",
      "name": "Hotel Restaurant"
    },
    {
      "identifier": "42ecb8e2fec7402ea4941db661313950",
      "name": "Hotel Bar"
    }
  ],
  "teams": [
    {
      "identifier": "ea73a0ace3bd479697704cbbd61a9a97",
      "name": "Dishwashers"
    },
    {
      "identifier": "631fec56ce1e425ca80045a60911cf12",
      "name": "Bartenders"
    }
  ]
}
```

#### No account found

A 204 No Content response will be returned if no account matching the code can be found within the requesting master account.
